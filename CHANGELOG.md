變更日誌 (Changelog)
本文檔記錄了此專案所有重要的變更。

[3.0.2] - 2025-08-13

修正 (Fixed)
初始載入邏輯: 修正了應用程式初始化時的時序問題，確保從 localStorage 讀取的設定（如回測模式、日期範圍等）能夠在首次載入圖表數據時被正確應用。

指標分析範圍: 修正了「僅分析可見範圍」功能會錯誤地限制全域指標計算的問題。現在 EMA 與 ATR 將始終在完整的數據集上進行計算，以確保其準確性與連續性。

載入動畫: 統一了載入動畫的體驗，無論是初始載入還是後續數據請求，都會在圖表上顯示一致的載入疊層，取代了原有的全螢幕載入畫面。

新增 (Added)
使用者引導: 為側邊欄中的 EMA、MTA 及 ATR 等進階功能設定，新增了詳細的說明 Tooltip，以提升使用者體驗與易用性。

[3.0.1] - 2025-08-13

修正 (Fixed)
後端數據獲取邏輯: 修正了回測模式在請求大範圍歷史數據時，因後端 API 單次請求上限 (1000根 K棒) 而導致數據不完整的問題。後端伺服器 (server.js) 現已加入分頁請求 (Pagination) 邏輯，能夠自動、連續地獲取使用者指定日期範圍內的所有 K 線數據，確保長時間回測的準確性與完整性。

回測引擎穩定性: 修正了 backtester.js 中因變數名稱拼寫錯誤 (active 應為 activeTrade) 而導致在檢查止盈條件時程式崩潰的問題。

[3.0.0] - 2025-08-11

重構 (Refactored)
核心市場結構分析引擎:

重構了 smc-analyzer.js，將市場結構事件明確區分為「趨勢延續 (BOS)」與「趨勢轉變 (CHoCH)」。

新增 (Added)
專業化回測引擎:

動態倉位規模計算: 採用專業的風險管理模型，動態計算每筆交易的倉位大小。

整合 Top-Down 分析邏輯: 新增「HTF 偏好 (Bias)」選項，模擬器將只執行符合方向的交易。

ATR 動態風險管理: 整合 ATR 指標，允許使用基於 ATR 倍數的動態止損策略。

變更 (Changed)
使用者說明文件:

全面更新了「如何解讀圖表」說明文件，提供系統化的操作步驟。

[2.9.2] - 2025-08-08
修正 (Fixed)

MTA 功能修正: 修正了在繪製高時間週期 POI 背景時，因呼叫了不存在的 priceScale.isEmpty() 方法而導致的程式崩潰。已將其替換為更穩健的存在性檢查，確保 MTA 功能穩定運行。

[2.9.1] - 2025-08-08
修正 (Fixed)

MTA 功能修正: 修正了在啟用多時間週期分析 (MTA) 時，因無法正確取得價格座標軸而導致程式崩潰的問題。已將繪圖邏輯更新為更穩健的 candleSeries.priceScale() 方法，確保高時間週期 (HTF) 的 POI 區域能夠被正確繪製。

[2.9.0] - 2025-08-08
新增 (Added)

新增多時間週期分析 (Multi-Timeframe Analysis, MTA) 功能:

介面: 在側邊欄新增了「啟用 MTA」的開關，以及一個用來選擇更高時間週期 (HTF) 的下拉選單。

圖表顯示: 啟用後，來自更高時間週期的關鍵支撐/壓力區 (OB, FVG, Breaker) 將會以半透明的背景色塊形式，繪製在當前的圖表上。

策略模擬升級: 回測引擎已完全整合 MTA 邏輯。啟用後，模擬器只會在價格進入 HTF 關鍵區域後，才開始尋找低時間週期 (LTF) 的進場確認訊號（如 CHoCH 或 MSS）。此功能旨在實現「順大勢，逆小勢」的交易原則，過濾大量低品質訊號，顯著提升策略勝率。

[2.8.0] - 2025-08-08
變更 (Changed)

優化初始載入體驗: 引入 Alpine.js 的 x-cloak 指令，解決了在頁面載入初期可能出現的「未初始化內容閃爍 (FOUC)」問題，提供了更平滑的視覺過渡。

[2.7.3] - 2025-08-08
變更 (Changed)

UI/UX 優化: 微調了側邊欄的內部間距 (padding)，使其在視覺上更加一致且平衡。

[2.7.2] - 2025-08-08
修正 (Fixed)

側邊欄介面修正: 重構了「自訂常用交易對」區塊的排版，將輸入框與新增按鈕改為上下排列，解決了在某些情況下按鈕會被擠壓到可視範圍外的問題。

[2.7.1] - 2025-08-08
修正 (Fixed)

側邊欄介面修正: 修正了在「自訂常用交易對」區塊中，新增按鈕會被父層容器的邊距擠壓到可視範圍外的排版問題。

[2.7.0] - 2025-08-08
新增 (Added)

自訂常用交易對:

功能: 側邊欄的交易對選擇器已升級為一個可互動的列表。使用者現在可以自由新增或刪除他們常用的交易對。

永久保存: 該列表會自動儲存在瀏覽器的 localStorage 中，確保使用者下次訪問時設定依然存在，提升了個人化體驗。

[2.6.1] - 2025-08-08
修正 (Fixed)

EMA 計算邏輯修正: 修正了當「僅分析可見範圍」啟用時，EMA 會因計算數據不足而失準的問題。現在 EMA 指標將永遠基於全部已載入的歷史數據進行計算，以確保其作為長期趨勢判斷的準確性，而其他 SMC 指標則會繼續遵守可見範圍的設定。

[2.6.0] - 2025-08-08
新增 (Added)

新增趨勢過濾器 (EMA):

功能: 在側邊欄新增了「趨勢過濾器」選項，使用者可以啟用 EMA (指數移動平均線) 並自訂其週期。

圖表顯示: 啟用後，EMA 線將會直接繪製在主圖表上，讓使用者能直觀地判斷當前市場趨勢。

策略模擬增強: 在回測模式下啟用此過濾器，模擬器將只會執行順應 EMA 趨勢的交易（價格在 EMA 之上只做多，價格在 EMA 之下只做空），旨在過濾掉逆勢的低勝率交易，以提高整體策略的勝率。

[2.5.2] - 2025-08-08
修正 (Fixed)

Tooltip 閃爍修正: 解決了在「策略回測設定」中，滑鼠懸停在說明圖示上時，提示框會不停閃爍的問題。透過將 pointer-events-none 樣式應用於提示框，並使用 x-ref 精準定位，確保了滑鼠事件的穩定性。

[2.5.1] - 2025-08-08
重構 (Refactored)

Tooltip 實作優化: 引入 Alpine.js 的 Anchor 插件來處理「策略回測設定」中的提示框 (Tooltip) 定位。移除了原先手動計算定位的 CSS class，改用 x-anchor 指令，使程式碼更簡潔、可靠，並能自動處理邊界情況。

[2.5.0] - 2025-08-08
新增 (Added)
優化使用者體驗 (UX):

新增參數說明: 在「策略回測設定」視窗中，為每一個參數（如初始金額、風險回報比等）的標籤旁，都增加了一個說明圖示。滑鼠懸停在圖示上時，會顯示該參數的詳細解釋，幫助使用者更清楚地理解每個設定的意義，進而做出更有效的模擬。

[2.4.0] - 2025-08-08
變更 (Changed)
升級策略回測引擎:

擴展進場訊號: 模擬器現在會將「趨勢轉變 (CHoCH)」與「市場結構轉變 (MSS)」兩者都視為有效的進場確認訊號，使其能捕捉到更早的交易機會。

增加進場區域: 模擬器在尋找興趣點 (POI) 時，除了訂單塊 (OB) 和公平價值缺口 (FVG) 外，現在也會將「突破塊 (Breaker Block)」納入考慮，增加了策略的靈活性。

[2.3.0] - 2025-08-08
新增 (Added)
新增進階 SMC 分析概念:

趨勢轉變 (Change of Character - CHoCH): 在圖表上自動標示黃色的 CHoCH 線，作為市場可能反轉的早期預警訊號。

突破塊 (Breaker Block - BB): 自動標示紫色的 Breaker Block 區域。此為被突破後角色互換的訂單塊，是新的潛在支撐/壓力區。

在側邊欄新增對應的顯示開關，並更新了「如何解讀圖表」說明文件。

[2.2.1] - 2025-08-08
修正 (Fixed)
圖表渲染修正:

修正了成交量圖表長條圖會「浮在空中」的視覺問題。

透過修改圖表庫的全域覆蓋座標軸設定，強制成交量圖的基線從 0 開始繪製，使其正確貼齊圖表底部。

[2.2.0] - 2025-08-08
變更 (Changed)
介面佈局優化:

將頁首 (header) 的定位方式改為 fixed，使其永久固定在螢幕頂部，方便使用者隨時操作。

相應地為主內容區 (main) 增加了上邊距，以防止內容被固定的頁首遮擋。
設定介面重組:

將「僅分析可見範圍」的開關從頁首移動至側邊欄的「圖表顯示」區塊，將所有設定選項集中管理。

修正 (Fixed)
響應式設計:

修正了在小螢幕（如手機）上，「回測模擬結果」中的交易紀錄表格會因內容過多而排版錯亂的問題。現在表格在窄螢幕下可以水平捲動。

[2.1.0] - 2025-08-08
新增 (Added)
範圍分析模式: 在頁首新增「僅分析可見範圍」的開關。啟用後，所有圖表上的 SMC 指標將只根據當前螢幕可見的 K 棒進行即時計算與繪製，方便使用者專注分析特定市場區段。

[2.0.0] - 2025-08-08
新增 (Added)
回測參數可配置化:

在「策略回測設定」視窗中新增「等待 K 棒數量」(setupExpirationCandles) 的輸入欄位，讓使用者可以自訂交易設定的有效期限。
UI/UX 優化:

新增「顯示已緩解區域」的開關，讓使用者可以在保持圖表乾淨（預設）和查看完整歷史結構之間自由切換。

重構 (Refactored)
前端介面元件化:

建立 smc/components/ 資料夾。

將 index.html 中主要的 UI 區塊（側邊欄、頁首、所有 Modal 視窗）拆分為獨立的 .html 元件檔案。

更新 main.js 以非同步方式動態載入這些 HTML 元件，大幅簡化了 index.html 的結構，使其只作為一個應用程式的骨架。

修正 (Fixed)
回測邏輯修正:

為等待中的交易設定 (setup) 加入了「有效期限」機制，解決了模擬器在找到第一個交易機會後就「卡住」，不再尋找新機會的問題。

修正了 backtester.js 中交易方向的命名不一致問題（'BULLISH' -> 'LONG', 'BEARISH' -> 'SHORT'), 確保回測結果能被前端正確顯示顏色。

移除了 smc-analyzer.js 中導致「前視偏誤」(Look-ahead Bias) 的邏輯，確保回測引擎在做決策時不會「偷看」未來的價格資訊。

修正了 findNearestPOI 函式中的判斷條件，確保由 MSS K 線自身創造的 POI 能夠被正確識別。

[1.0.0] - 2025-08-07
重構 (Refactored)
JavaScript 模組化:

建立 smc/modules/ 資料夾。

將原先龐大的 main.js 檔案，根據職責拆分為多個獨立的模組：

api.js: 處理所有網路請求。

chart-controller.js: 封裝所有圖表相關的操作。

smc-analyzer.js: 核心的 SMC 策略計算引擎。

backtester.js: 獨立的回測模擬引擎。

main.js: 作為應用程式主入口與協調者。
前端啟動流程:

將 main.js 作為唯一的腳本入口，由其負責動態匯入並啟動 Alpine.js 框架，解決了複雜的腳本載入順序與競爭問題。