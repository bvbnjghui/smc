<!-- smc/components/sidebar.html -->
<aside 
    class="fixed top-0 left-0 h-full w-64 bg-gray-800 shadow-lg z-50 transform transition-transform duration-300 ease-in-out"
    :class="{ 'translate-x-0': isSidebarOpen, '-translate-x-full': !isSidebarOpen }"
>
    <div class="px-2 py-4 flex flex-col h-full">
        <h2 class="text-2xl font-bold text-teal-400 mb-6 flex-shrink-0 px-2">設定</h2>
        <div class="space-y-6 flex-grow overflow-y-auto px-2 sidebar-content">
            
            <!-- 自訂常用交易對列表 -->
            <div class="space-y-3">
                <label class="text-gray-400">常用交易對:</label>
                <div class="space-y-2">
                    <input type="text" x-model="newCustomSymbol" @keydown.enter="addSymbol()" placeholder="例如：ADAUSDT" class="w-full p-2 rounded-lg bg-gray-700 border border-gray-600 focus:outline-none focus:ring-2 focus:ring-teal-500 text-gray-50 uppercase placeholder-gray-500">
                    <button @click="addSymbol()" class="w-full bg-teal-600 text-white font-semibold py-2 rounded-lg hover:bg-teal-700 transition duration-300">
                        新增
                    </button>
                </div>
                <div class="space-y-2 max-h-48 overflow-y-auto">
                    <template x-for="sym in commonSymbols" :key="sym">
                        <div 
                            @click="selectSymbol(sym)"
                            class="flex items-center justify-between p-2 rounded-lg cursor-pointer transition duration-200"
                            :class="{ 'bg-teal-500 text-white': symbol === sym, 'hover:bg-gray-700': symbol !== sym }"
                        >
                            <span class="font-medium" x-text="sym"></span>
                            <button @click.stop="removeSymbol(sym)" class="p-1 rounded-full hover:bg-red-500/50 text-gray-400 hover:text-white">
                                <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w.org/2000/svg"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"></path></svg>
                            </button>
                        </div>
                    </template>
                </div>
            </div>

            <!-- 週期設定 -->
            <div class="space-y-2">
                <label for="interval" class="text-gray-400">週期:</label>
                <select id="interval" x-model="interval" @change="stopAutoUpdate()" class="w-full p-2 rounded-lg bg-gray-700 border border-gray-600 focus:outline-none focus:ring-2 focus:ring-teal-500 text-gray-50">
                    <template x-for="option in intervals">
                        <option :value="option.value" x-text="option.label" :selected="option.value === interval"></option>
                    </template>
                </select>
            </div>
            
            <!-- 載入按鈕 -->
            <div>
                <button @click="fetchData(); isSidebarOpen = false" :disabled="isLoading" class="w-full bg-teal-600 text-white font-semibold py-2 px-6 rounded-lg hover:bg-teal-700 transition duration-300 shadow-lg disabled:opacity-50 disabled:cursor-not-allowed">
                    <span x-show="!isLoading && !isBacktestMode">載入數據</span>
                    <span x-show="!isLoading && isBacktestMode">載入回測數據</span>
                    <span x-show="isLoading">載入中...</span>
                </button>
            </div>
            
            <!-- 回測模式設定 -->
            <div class="space-y-4 pt-4 border-t border-gray-700">
                <div class="flex items-center justify-between text-gray-400">
                    <span>回測模式</span>
                    <div class="relative inline-block w-10 align-middle select-none">
                        <input type="checkbox" id="backtestMode" x-model="isBacktestMode" class="toggle-checkbox absolute block w-6 h-6 rounded-full bg-white border-4 appearance-none cursor-pointer"/>
                        <label for="backtestMode" class="toggle-label block overflow-hidden h-6 rounded-full bg-gray-600 cursor-pointer"></label>
                    </div>
                </div>
                <div x-show="isBacktestMode" x-collapse class="space-y-2">
                    <div>
                        <label for="startDate" class="text-sm text-gray-400">開始日期:</label>
                        <input type="date" id="startDate" x-model="backtestStartDate" class="w-full p-2 rounded-lg bg-gray-700 border border-gray-600 focus:outline-none focus:ring-2 focus:ring-teal-500 text-gray-50">
                    </div>
                     <div>
                        <label for="endDate" class="text-sm text-gray-400">結束日期:</label>
                        <input type="date" id="endDate" x-model="backtestEndDate" class="w-full p-2 rounded-lg bg-gray-700 border border-gray-600 focus:outline-none focus:ring-2 focus:ring-teal-500 text-gray-50">
                    </div>
                </div>
            </div>

            <!-- 策略回測模擬區塊 -->
            <div x-show="isBacktestMode" x-collapse class="space-y-4 pt-4 border-t border-gray-700">
                <h3 class="text-lg font-semibold text-gray-300">策略回測模擬</h3>
                <button @click="isSimulationSettingsModalOpen = true; isSidebarOpen = false" :disabled="currentCandles.length === 0" class="w-full bg-indigo-600 text-white font-semibold py-2 px-6 rounded-lg hover:bg-indigo-700 transition duration-300 shadow-lg disabled:opacity-50 disabled:cursor-not-allowed">
                    <span>設定並執行模擬...</span>
                </button>
            </div>
            
            <!-- 圖表顯示設定 -->
            <div class="space-y-4 pt-4 border-t border-gray-700">
                <h3 class="text-lg font-semibold text-gray-300">圖表顯示</h3>
                <div class="flex items-center justify-between text-gray-400">
                    <span>流動性 (BSL/SSL)</span>
                    <div class="relative inline-block w-10 align-middle select-none">
                        <input type="checkbox" id="showLiquidity" x-model="showLiquidity" @change="redrawChartAnalyses()" class="toggle-checkbox absolute block w-6 h-6 rounded-full bg-white border-4 appearance-none cursor-pointer"/>
                        <label for="showLiquidity" class="toggle-label block overflow-hidden h-6 rounded-full bg-gray-600 cursor-pointer"></label>
                    </div>
                </div>
                <div class="flex items-center justify-between text-gray-400">
                    <span>結構突破 (BOS)</span>
                    <div class="relative inline-block w-10 align-middle select-none">
                        <input type="checkbox" id="showBOS" x-model="showBOS" @change="redrawChartAnalyses()" class="toggle-checkbox absolute block w-6 h-6 rounded-full bg-white border-4 appearance-none cursor-pointer"/>
                        <label for="showBOS" class="toggle-label block overflow-hidden h-6 rounded-full bg-gray-600 cursor-pointer"></label>
                    </div>
                </div>
                <div class="flex items-center justify-between text-gray-400">
                    <span>趨勢轉變 (CHoCH)</span>
                    <div class="relative inline-block w-10 align-middle select-none">
                        <input type="checkbox" id="showCHoCH" x-model="showCHoCH" @change="redrawChartAnalyses()" class="toggle-checkbox absolute block w-6 h-6 rounded-full bg-white border-4 appearance-none cursor-pointer"/>
                        <label for="showCHoCH" class="toggle-label block overflow-hidden h-6 rounded-full bg-gray-600 cursor-pointer"></label>
                    </div>
                </div>
                <div class="flex items-center justify-between text-gray-400">
                    <span>訂單塊 (OB)</span>
                    <div class="relative inline-block w-10 align-middle select-none">
                        <input type="checkbox" id="showOrderBlocks" x-model="showOrderBlocks" @change="redrawChartAnalyses()" class="toggle-checkbox absolute block w-6 h-6 rounded-full bg-white border-4 appearance-none cursor-pointer"/>
                        <label for="showOrderBlocks" class="toggle-label block overflow-hidden h-6 rounded-full bg-gray-600 cursor-pointer"></label>
                    </div>
                </div>
                <div class="flex items-center justify-between text-gray-400">
                    <span>突破塊 (Breaker)</span>
                    <div class="relative inline-block w-10 align-middle select-none">
                        <input type="checkbox" id="showBreakerBlocks" x-model="showBreakerBlocks" @change="redrawChartAnalyses()" class="toggle-checkbox absolute block w-6 h-6 rounded-full bg-white border-4 appearance-none cursor-pointer"/>
                        <label for="showBreakerBlocks" class="toggle-label block overflow-hidden h-6 rounded-full bg-gray-600 cursor-pointer"></label>
                    </div>
                </div>
                <div class="flex items-center justify-between text-gray-400">
                    <span>公平價值缺口 (FVG)</span>
                    <div class="relative inline-block w-10 align-middle select-none">
                        <input type="checkbox" id="showFVGs" x-model="showFVGs" @change="redrawChartAnalyses()" class="toggle-checkbox absolute block w-6 h-6 rounded-full bg-white border-4 appearance-none cursor-pointer"/>
                        <label for="showFVGs" class="toggle-label block overflow-hidden h-6 rounded-full bg-gray-600 cursor-pointer"></label>
                    </div>
                </div>
                <div class="flex items-center justify-between text-gray-400">
                    <span>顯示已緩解區域</span>
                    <div class="relative inline-block w-10 align-middle select-none">
                        <input type="checkbox" id="showMitigated" x-model="showMitigated" @change="redrawChartAnalyses()" class="toggle-checkbox absolute block w-6 h-6 rounded-full bg-white border-4 appearance-none cursor-pointer"/>
                        <label for="showMitigated" class="toggle-label block overflow-hidden h-6 rounded-full bg-gray-600 cursor-pointer"></label>
                    </div>
                </div>
                <div class="flex items-center justify-between text-gray-400">
                    <span>僅分析可見範圍</span>
                    <div class="relative inline-block w-10 align-middle select-none">
                        <input type="checkbox" id="analyzeVisibleRange" x-model="analyzeVisibleRangeOnly" @change="redrawChartAnalyses()" class="toggle-checkbox absolute block w-6 h-6 rounded-full bg-white border-4 appearance-none cursor-pointer"/>
                        <label for="analyzeVisibleRange" class="toggle-label block overflow-hidden h-6 rounded-full bg-gray-600 cursor-pointer"></label>
                    </div>
                </div>
            </div>

            <!-- 趨勢過濾器設定區塊 -->
            <div class="space-y-4 pt-4 border-t border-gray-700">
                <h3 class="text-lg font-semibold text-gray-300">趨勢過濾器 (EMA)</h3>
                <div class="flex items-center justify-between text-gray-400">
                    <span>啟用過濾器</span>
                    <div class="relative inline-block w-10 align-middle select-none">
                        <input type="checkbox" id="enableTrendFilter" x-model="enableTrendFilter" @change="redrawChartAnalyses()" class="toggle-checkbox absolute block w-6 h-6 rounded-full bg-white border-4 appearance-none cursor-pointer"/>
                        <label for="enableTrendFilter" class="toggle-label block overflow-hidden h-6 rounded-full bg-gray-600 cursor-pointer"></label>
                    </div>
                </div>
                <div x-show="enableTrendFilter" x-collapse class="space-y-2">
                    <div class="flex items-center space-x-2">
                        <label for="emaPeriod" class="text-sm text-gray-400">EMA 週期:</label>
                        <div x-data="{ tooltipVisible: false }" @mouseenter="tooltipVisible = true" @mouseleave="tooltipVisible = false" class="relative">
                            <button x-ref="infoBtnEma" type="button" class="text-gray-500 hover:text-gray-300">
                                <svg class="w-4 h-4" fill="currentColor" viewBox="0 0 20 20" xmlns="http://www.w3.org/2000/svg"><path fill-rule="evenodd" d="M18 10a8 8 0 11-16 0 8 8 0 0116 0zm-7-4a1 1 0 11-2 0 1 1 0 012 0zM9 9a1 1 0 000 2v3a1 1 0 001 1h1a1 1 0 100-2v-3a1 1 0 00-1-1H9z" clip-rule="evenodd"></path></svg>
                            </button>
                            <div x-show="tooltipVisible" x-anchor.bottom.offset.4="$refs.infoBtnEma" x-transition class="absolute w-56 bg-gray-900 text-gray-200 text-xs rounded-lg p-2 shadow-lg z-10 pointer-events-none">
                                指數移動平均線的計算週期。常用於判斷長期趨勢，例如 50 或 200。回測時，價格在 EMA 之上只做多，反之只做空。
                            </div>
                        </div>
                    </div>
                    <input type="number" id="emaPeriod" x-model.number="emaPeriod" @change="redrawChartAnalyses()" placeholder="例如：50" class="w-full p-2 rounded-lg bg-gray-700 border border-gray-600 focus:outline-none focus:ring-2 focus:ring-teal-500 text-gray-50 placeholder-gray-500">
                </div>
            </div>
            
            <!-- 多時間週期分析 (MTA) -->
            <div class="space-y-4 pt-4 border-t border-gray-700">
                <h3 class="text-lg font-semibold text-gray-300">多時間週期分析 (MTA)</h3>
                <div class="flex items-center justify-between text-gray-400">
                    <div class="flex items-center space-x-2">
                        <span>啟用 MTA</span>
                        <div x-data="{ tooltipVisible: false }" @mouseenter="tooltipVisible = true" @mouseleave="tooltipVisible = false" class="relative">
                            <button x-ref="infoBtnMta" type="button" class="text-gray-500 hover:text-gray-300">
                                <svg class="w-4 h-4" fill="currentColor" viewBox="0 0 20 20" xmlns="http://www.w3.org/2000/svg"><path fill-rule="evenodd" d="M18 10a8 8 0 11-16 0 8 8 0 0116 0zm-7-4a1 1 0 11-2 0 1 1 0 012 0zM9 9a1 1 0 000 2v3a1 1 0 001 1h1a1 1 0 100-2v-3a1 1 0 00-1-1H9z" clip-rule="evenodd"></path></svg>
                            </button>
                            <div x-show="tooltipVisible" x-anchor.bottom.offset.4="$refs.infoBtnMta" x-transition class="absolute w-56 bg-gray-900 text-gray-200 text-xs rounded-lg p-2 shadow-lg z-10 pointer-events-none">
                                啟用後，會將更高時間週期的關鍵區域 (POI) 繪製在當前圖表上。回測時，模擬器只會在價格進入這些 HTF 區域後才尋找進場機會。
                            </div>
                        </div>
                    </div>
                    <div class="relative inline-block w-10 align-middle select-none">
                        <input type="checkbox" id="enableMTA" x-model="enableMTA" @change="fetchData()" class="toggle-checkbox absolute block w-6 h-6 rounded-full bg-white border-4 appearance-none cursor-pointer"/>
                        <label for="enableMTA" class="toggle-label block overflow-hidden h-6 rounded-full bg-gray-600 cursor-pointer"></label>
                    </div>
                </div>
                <div x-show="enableMTA" x-collapse class="space-y-2">
                    <label for="higherTimeframe" class="text-sm text-gray-400">高時間週期 (HTF):</label>
                    <select id="higherTimeframe" x-model="higherTimeframe" @change="fetchData()" class="w-full p-2 rounded-lg bg-gray-700 border border-gray-600 focus:outline-none focus:ring-2 focus:ring-teal-500 text-gray-50">
                        <template x-for="option in availableHigherTimeframes">
                            <option :value="option.value" x-text="option.label"></option>
                        </template>
                    </select>
                </div>
            </div>
            
            <!-- ATR 風險管理 -->
            <div class="space-y-4 pt-4 border-t border-gray-700">
                <h3 class="text-lg font-semibold text-gray-300">ATR 風險管理</h3>
                 <div class="flex items-center justify-between text-gray-400">
                    <span>啟用 ATR 止損</span>
                    <div class="relative inline-block w-10 align-middle select-none">
                        <input type="checkbox" id="enableATR" x-model="enableATR" @change="redrawChartAnalyses()" class="toggle-checkbox absolute block w-6 h-6 rounded-full bg-white border-4 appearance-none cursor-pointer"/>
                        <label for="enableATR" class="toggle-label block overflow-hidden h-6 rounded-full bg-gray-600 cursor-pointer"></label>
                    </div>
                </div>
                <div x-show="enableATR" x-collapse class="space-y-2">
                    <div>
                        <div class="flex items-center space-x-2">
                            <label for="atrPeriod" class="text-sm text-gray-400">ATR 週期:</label>
                             <div x-data="{ tooltipVisible: false }" @mouseenter="tooltipVisible = true" @mouseleave="tooltipVisible = false" class="relative">
                                <button x-ref="infoBtnAtrPeriod" type="button" class="text-gray-500 hover:text-gray-300">
                                    <svg class="w-4 h-4" fill="currentColor" viewBox="0 0 20 20" xmlns="http://www.w3.org/2000/svg"><path fill-rule="evenodd" d="M18 10a8 8 0 11-16 0 8 8 0 0116 0zm-7-4a1 1 0 11-2 0 1 1 0 012 0zM9 9a1 1 0 000 2v3a1 1 0 001 1h1a1 1 0 100-2v-3a1 1 0 00-1-1H9z" clip-rule="evenodd"></path></svg>
                                </button>
                                <div x-show="tooltipVisible" x-anchor.bottom.offset.4="$refs.infoBtnAtrPeriod" x-transition class="absolute w-56 bg-gray-900 text-gray-200 text-xs rounded-lg p-2 shadow-lg z-10 pointer-events-none">
                                    計算平均真實波幅 (Average True Range) 的 K 棒數量。常用值為 14。
                                </div>
                            </div>
                        </div>
                        <input type="number" id="atrPeriod" x-model.number="atrPeriod" @change="redrawChartAnalyses()" class="w-full p-2 rounded-lg bg-gray-700 border border-gray-600 focus:outline-none focus:ring-2 focus:ring-teal-500 text-gray-50">
                    </div>
                    <div>
                        <div class="flex items-center space-x-2">
                             <label for="atrMultiplier" class="text-sm text-gray-400">ATR 止損乘數:</label>
                             <div x-data="{ tooltipVisible: false }" @mouseenter="tooltipVisible = true" @mouseleave="tooltipVisible = false" class="relative">
                                <button x-ref="infoBtnAtrMult" type="button" class="text-gray-500 hover:text-gray-300">
                                    <svg class="w-4 h-4" fill="currentColor" viewBox="0 0 20 20" xmlns="http://www.w3.org/2000/svg"><path fill-rule="evenodd" d="M18 10a8 8 0 11-16 0 8 8 0 0116 0zm-7-4a1 1 0 11-2 0 1 1 0 012 0zM9 9a1 1 0 000 2v3a1 1 0 001 1h1a1 1 0 100-2v-3a1 1 0 00-1-1H9z" clip-rule="evenodd"></path></svg>
                                </button>
                                <div x-show="tooltipVisible" x-anchor.bottom.offset.4="$refs.infoBtnAtrMult" x-transition class="absolute w-56 bg-gray-900 text-gray-200 text-xs rounded-lg p-2 shadow-lg z-10 pointer-events-none">
                                    止損距離將會是「進場時的 ATR 值 × 此乘數」。建議值為 1.5 到 3 之間，用以將止損點設在市場正常波動範圍之外。
                                </div>
                            </div>
                        </div>
                        <input type="number" id="atrMultiplier" x-model.number="atrMultiplier" step="0.1" min="0.1" class="w-full p-2 rounded-lg bg-gray-700 border border-gray-600 focus:outline-none focus:ring-2 focus:ring-teal-500 text-gray-50">
                    </div>
                </div>
            </div>

            <!-- 交易時段過濾 -->
            <div class="space-y-4 pt-4 border-t border-gray-700">
                <h3 class="text-lg font-semibold text-gray-300">交易時段過濾</h3>
                 <div class="flex items-center justify-between text-gray-400">
                    <span>啟用時段過濾</span>
                    <div class="relative inline-block w-10 align-middle select-none">
                        <input type="checkbox" id="enableKillzoneFilter" x-model="enableKillzoneFilter" class="toggle-checkbox absolute block w-6 h-6 rounded-full bg-white border-4 appearance-none cursor-pointer"/>
                        <label for="enableKillzoneFilter" class="toggle-label block overflow-hidden h-6 rounded-full bg-gray-600 cursor-pointer"></label>
                    </div>
                </div>
                <div x-show="enableKillzoneFilter" x-collapse class="space-y-2 pl-4">
                    <div class="flex items-center">
                        <input type="checkbox" id="useLondonKillzone" x-model="useLondonKillzone" class="w-4 h-4 text-teal-600 bg-gray-700 border-gray-600 rounded focus:ring-teal-500">
                        <label for="useLondonKillzone" class="ml-2 text-sm text-gray-300">倫敦時段 (07-10 UTC)</label>
                    </div>
                    <div class="flex items-center">
                        <input type="checkbox" id="useNewYorkKillzone" x-model="useNewYorkKillzone" class="w-4 h-4 text-teal-600 bg-gray-700 border-gray-600 rounded focus:ring-teal-500">
                        <label for="useNewYorkKillzone" class="ml-2 text-sm text-gray-300">紐約時段 (12-15 UTC)</label>
                    </div>
                </div>
            </div>

            <!-- 自動更新 -->
            <div class="flex items-center justify-between space-x-2 text-gray-400 pt-4 border-t border-gray-700" :class="{ 'opacity-50': isBacktestMode }">
                <span>自動更新</span>
                <div class="relative inline-block w-10 align-middle select-none transition duration-200 ease-in">
                    <input type="checkbox" name="toggle" id="toggle" x-model="autoUpdate" @change="toggleAutoUpdate()" :disabled="isBacktestMode" class="toggle-checkbox absolute block w-6 h-6 rounded-full bg-white border-4 appearance-none cursor-pointer"/>
                    <label for="toggle" class="toggle-label block overflow-hidden h-6 rounded-full bg-gray-600 cursor-pointer"></label>
                </div>
            </div>
        </div>

        <!-- 側邊欄底部說明按鈕 -->
        <div class="mt-auto flex-shrink-0">
             <button @click="isHelpModalOpen = true; isSidebarOpen = false" class="w-full text-left text-gray-300 hover:bg-gray-700 hover:text-white p-3 rounded-md flex items-center space-x-2">
                <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8.228 9c.549-1.165 2.03-2 3.772-2 2.21 0 4 1.79 4 4 0 1.152-.468 2.19-1.228 2.967-.76.776-1.805 1.287-3.033 1.615A2.25 2.25 0 0113 18h-1a2.25 2.25 0 01-2.25-2.25V15.25a2.25 2.25 0 011.5-2.122zM12 6v.01M12 18v.01"></path></svg>
                <span>如何解讀圖表?</span>
            </button>
        </div>
    </div>
</aside>
